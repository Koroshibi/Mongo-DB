<html>
  <head>
    <script src="ejs.js"></script>
  </head>

  <body>
    <input type="date" id="filteredDate" />
    <button type="submit" onclick="setSearchDate()">Valider</button>
    <table style="border: 1px solid black;">
      <tr>
        <th style="border: 1px solid black;" onclick="setFilterField('id')">ID</th>
        <th style="border: 1px solid black;" onclick="setFilterField('name')">Name</th>
        <th style="border: 1px solid black;" onclick="setFilterField('description')">Description</th>
        <th style="border: 1px solid black;" onclick="setFilterField('last_scraped')">Last scraped</th>
      </tr>
      <% data.forEach((airbnb) => { %>
        <tr onClick="location.pathname = '/airbnb/<%= airbnb.id %>'" style="border: 1px solid black;">
          <td style="border: 1px solid black;"><%= airbnb.id %></td>
          <td style="border: 1px solid black;"><%= airbnb.name %></td>
          <td style="border: 1px solid black;"><%= airbnb.description %></td>
          <td style="border: 1px solid black;"><%= airbnb.last_scraped %></td>
        </tr>
      <% }) %>
    </table>

    <script>
      const getObjectLocation = () => {
        const splitLocation = location.search.replace('?', '').split('&')
        return splitLocation.reduce((acc, current) => {
          const splitCurrent = current.replace('?', '').split('=')
          return {
            ...acc,
            [splitCurrent[0]]: splitCurrent[1]
          }
        }, {})
      }

      const setSearchDate = () => {
        const dateToFilter = document.getElementById('filteredDate');
        location.search = `${location.search.length > 0 ? '' : '?'}filter=${dateToFilter.value}`
      }

      const setFilterField = (currentField) => {
        const currentLocation = getObjectLocation()
        console.log({currentLocation})
        const filter = currentLocation.filter ? currentLocation.filter : null
        let sort = currentLocation.sort ? currentLocation.sort : null
        let field = currentLocation.field ? currentLocation.field : null

        if (field === currentField) {
          console.log('sort', sort)
          sort = (sort === 'ASC' ? 'DESC' : 'ASC')
        } else {
          field = currentField
          sort = 'ASC'
        }

        location.search = `${filter ? `filter=${filter}` : ''}${filter ? '&' : ''}${sort ? `sort=${sort}` : ''}${sort ? '&' : ''}${field ? `field=${field}` : ''}`
      }
    </script>
  </body>

</html>